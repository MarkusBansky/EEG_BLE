# EEG ADS1299 BLE NRF51822
Minimal implementation of EEG device with BLE (concept) and high CMRR (140dB).


### Circuit Schematics

```
Disclaimer:
I am just an absolute beginner in circuit electronics.
Scematics are 'work in progress' and need a review 
from an experienced engineer.
```

Schematics based on notes taken from discussions at `Texas Instruments` forum:

1. [ADS1299, 4 electrodes, basic eeg, bias drive](https://e2e.ti.com/support/data_converters/precision_data_converters/f/73/t/268235)
2. [Common mode rejection for ADS1299](https://e2e.ti.com/support/data_converters/precision_data_converters/f/73/t/257069).

![Screenshot](/KiCad/Project/screenshot.png?raw=true "Optional Title")

**Brief by the author**

```
Following are collected crucial excerpts from notes, 
shamelessly scrapped from both forum threads mentioned above.
```
The idea is to increase common mode amplification and in that way to increase `CMRR`.  I've modified bias driver (*Driven Right Leg circuit*) and I've achieved `CMRR` of **143dB** on amplification of the 24.

The modification is next: 
On the schematic on figure 52 ([SBAS499A PDF - PDF about ADS1299](http://www.ti.com/lit/ds/symlink/ads1299.pdf)), you have RC circuit on pins BIASINV and BIASREF (Cext - 1.5nF and Rext - 1M). Remove that components. Now you have open loop BIAS-amp, but the loop is closed over the patient. The only thing that you must to do is to put serial resistor of `1M` on `BIASOUT` pin to limit maximum current that may flow to the patient. With this configuration, you will get `CMRR `of **143dB** and will have great EEG recordings without using Notch filter of 50/60Hz.

**Detailed explanation**

For `n` channel EEG you need `n` INP inputs of the ADS1299 for EEG signal measurement, for example you can use INP1, ..., INPn. For reference electrode you cannot use SRB pins, because they are not routed directly to the amplifiers input. 
The SRBx lines are used to allow you to route a common signal to all the inputs. One thing to keep in mind is that when you do this, you are going to have mismatching between your (+) and (-) inputs which may cause a higher 50/60Hz component to show.

The better solution is to short-circuit INM inputs (INM1 to INMn) and this connection use as reference electrode.

Because EEG signal amplitude is small, about 10uV, you must use **RLD circuit** for bias drive.
RLD means **Right Leg Drive**. It's a feature to improve `CMRR` by driving your body actively via a seperate electrode.

Use only `BIAS_OUT` pin of the `ADS1299` and connect it to the parallel RC network (`R1``C1`), **without** connection to the `BIAS_INV`. In this way you have open-loop amplifier in the feed-back loop of the first stage of the instrumentation amplifier. With this connection you can reach CMRR of about 140dB (measured with EEG patient cable). 

I've also tried to record real EEG data with that configuration and I've got fantastic results. **I'ts amazing.**

Another **very important thing** is that you must use battery power supply, or if you use USB or some wall adapter, use isolation DC/DC converter for patient safety and for better CMRR performance.

As for RLD amplifier, it is open loop amplifier in closed loop. The loop is closed trough the IN1P - INnP amplifiers. Belive me, it works 1000 times better than conventional RLD circuit.

**To sum up:**

- The sensing electrodes are connected to positive inputs of all channels

- The reference Signal is fed to all negative inputs of the channels 1-8.

- `BIASOUT` is connected to the bias electrode by the RC circuit (R = `~1M` to limit current going tot he patient, C = `10nF`(?) **Note:** needs a review. The Bias Signal is generated by using the internal (or external) bias reference with setting register `BIASREF_INT=1` (`BIASREF_INT=0`) and compare it with the internal `BIAS_AMP` with the electrode DC signals of all inputs (positive and negative). The signal from th input is routed to the `BIAS_AMP` by setting the register entries `BIAS_SENS[x]=1`. The output of the amplifier `BIASOUT` should then be connected with the bias electrode that is used to set the patient to a defined potential.  `This point needs a review`

- `BIASINV` is not connected to anything; no RC network between `BIASOUT` and `BIASINV`

- `BIASREF_INT=1`, `BIAS_SENSP=1` for all channels. `is BIAS_SENSN=1 also?`